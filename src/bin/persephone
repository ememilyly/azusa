#!/usr/bin/env python
import argparse
import discord
from discord.ext import commands
from persephone import persephone, helpers, methods
import logging

import asyncio
import os

parser = argparse.ArgumentParser(description='Run Persephone')
parser.add_argument('-p', '--prefix', help='Command prefix', required=True)
args = parser.parse_args()

discord.utils.setup_logging(level=logging.INFO)
_log = logging.getLogger(__name__)


# add my methods
commands.Context.paged_reply = methods.paged_reply


async def main():
    async with bot:
        for ext in bot.available_extensions:
            try:
                await bot.load_extension(ext)
            except commands.ExtensionError:
                raise
                continue

        await bot.start(os.environ("BOT_TOKEN"))


if __name__ == "__main__":

    bot = persephone.Persephone(args["prefix"], intents=discord.Intents.all())
    bot.owner_id = int(os.environ("OWNER_ID"))
    bot.cogs_dir = "cogs"

    asyncio.run(main())
